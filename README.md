# Sample Python Application with GitHub Actions CI/CD

This repository demonstrates how to set up a Python application with automated testing, code coverage reports, and Docker image building using GitHub Actions.

## Project Structure

```
├── app
├── contact_app
├── db.sqlite3
├── Dockerfile
├── k8s-ci-load-test-main
│   ├── deployment-foo-bar.yaml
│   ├── kindCluster.yaml
│   ├── loadtest.js
│   ├── nginxIngress.yaml
│   └── README.md
├── manage.py
├── pytest.ini
├── README.md
└── requirements.txt
```

### **Folder Structure**

- **`app/`**: Contains the main Python application logic .
- **`.github/workflows/`**: GitHub Actions workflow file that automates testing, coverage, and Docker image building.
- **`Dockerfile`**: Defines the Docker image for the application.
- **`requirements.txt`**: Lists Python dependencies such as `coverage` and `unittest2`.
- **`coverage.xml`**: The coverage report generated by the `coverage` tool.
- **`README.md`**: Documentation for the project.
- **`.gitignore`**: Specifies files to be ignored by Git.

---

## Setup Instructions

### **1. Install Dependencies**

To install the required Python dependencies, run:

```bash
pip install -r requirements.txt
```


### **2. Running the Tests Locally**

You can run the tests locally using:

```bash
pytest .
```

This will discover and run all the test cases.


---

## GitHub Actions Workflow

### **1. Workflow Overview**

This repository uses GitHub Actions to automate the following tasks:
- **Unit Test Execution**: Runs unit tests and generates a code coverage report.
- **Docker Image Building**: Builds and pushes a Docker image to Docker Hub when a pull request is merged into a protected branch.

### **2. Workflow Details**

The workflow is defined in `.github/workflows/test-and-build.yml` and runs on every pull request targeting the `main` or `protected-branch-name` branch. Here's what it does:

1. **Checkout Code**: Fetches the latest changes.
2. **Setup Python**: Installs Python and dependencies.
3. **Run Tests and Coverage**: Executes unit tests and generates a coverage report.
4. **Build and Push Docker Image**: On a successful PR merge, builds the Docker image and pushes it to Docker Hub.

---

## Docker Setup

### **1. Dockerfile**

The `Dockerfile` in the root directory specifies how to containerize the Python application. Here's a basic example:

```dockerfile
FROM ubuntu:18.04

RUN apt-get update && \
    apt-get -y upgrade && \
    DEBIAN_FRONTEND=noninteractive apt-get install -yq libpq-dev gcc python3.8 python3-pip && \
    apt-get clean

WORKDIR /app

COPY . /app/

RUN pip3 install -r requirements.txt 


EXPOSE 8000/tcp

CMD ["/bin/sh", "-c", "python3 manage.py runserver"]ss
```

This file builds an image with Python and runs the tests when the container starts.

### **2. Building and Pushing Docker Image**

After merging a PR into a protected branch (e.g., `main`), the GitHub Actions workflow builds and pushes a Docker image to Docker Hub. The image is tagged with the commit SHA.

